<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Othello Frontend</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <main>
        <div class="board">
            <div id="square0" class="square"></div>
            <div id="square1" class="square"></div>
            <div id="square2" class="square"></div>
            <div id="square3" class="square"></div>
            <div id="square4" class="square"></div>
            <div id="square5" class="square"></div>
            <div id="square6" class="square"></div>
            <div id="square7" class="square"></div>
            <div id="square8" class="square"></div>
            <div id="square9" class="square"></div>
            <div id="square10" class="square"></div>
            <div id="square11" class="square"></div>
            <div id="square12" class="square"></div>
            <div id="square13" class="square"></div>
            <div id="square14" class="square"></div>
            <div id="square15" class="square"></div>
            <div id="square16" class="square"></div>
            <div id="square17" class="square"></div>
            <div id="square18" class="square"></div>
            <div id="square19" class="square"></div>
            <div id="square20" class="square"></div>
            <div id="square21" class="square"></div>
            <div id="square22" class="square"></div>
            <div id="square23" class="square"></div>
            <div id="square24" class="square"></div>
            <div id="square25" class="square"></div>
            <div id="square26" class="square"></div>
            <div id="square27" class="square">
                <div id="piece27" class="white-piece"></div>
            </div>
            <div id="square28" class="square">
                <div id="piece28" class="black-piece"></div>
            </div>
            <div id="square29" class="square"></div>
            <div id="square30" class="square"></div>
            <div id="square31" class="square"></div>
            <div id="square32" class="square"></div>
            <div id="square33" class="square"></div>
            <div id="square34" class="square"></div>
            <div id="square35" class="square">
                <div id="piece35" class="black-piece"></div>
            </div>
            <div id="square36" class="square">
                <div id="piece36" class="white-piece"></div>
            </div>
            <div id="square37" class="square"></div>
            <div id="square38" class="square"></div>
            <div id="square39" class="square"></div>
            <div id="square40" class="square"></div>
            <div id="square41" class="square"></div>
            <div id="square42" class="square"></div>
            <div id="square43" class="square"></div>
            <div id="square44" class="square"></div>
            <div id="square45" class="square"></div>
            <div id="square46" class="square"></div>
            <div id="square47" class="square"></div>
            <div id="square48" class="square"></div>
            <div id="square49" class="square"></div>
            <div id="square50" class="square"></div>
            <div id="square51" class="square"></div>
            <div id="square52" class="square"></div>
            <div id="square53" class="square"></div>
            <div id="square54" class="square"></div>
            <div id="square55" class="square"></div>
            <div id="square56" class="square"></div>
            <div id="square57" class="square"></div>
            <div id="square58" class="square"></div>
            <div id="square59" class="square"></div>
            <div id="square60" class="square"></div>
            <div id="square61" class="square"></div>
            <div id="square62" class="square"></div>
            <div id="square63" class="square"></div>
        </div>
    </main>
</body>
<script>
    const WHITE_DISK = 1;
    const BLACK_DISK = -1;
    const NO_DISK = 0;
    const squaresList = document.querySelectorAll(".square")
    let whosTurn = BLACK_DISK;
    const startingBoard = [[0, 0, 0, 0, 0, 0, 0, 0],
                         [0, 0, 0, 0, 0, 0, 0, 0],
                         [0, 0, 0, 0, 0, 0, 0, 0],
                         [0, 0, 0, 1, -1, 0, 0, 0],
                         [0, 0, 0, -1, 1, 0, 0, 0],
                         [0, 0, 0, 0, 0, 0, 0, 0],
                         [0, 0, 0, 0, 0, 0, 0, 0],
                         [0, 0, 0, 0, 0, 0, 0, 0]];
    let currentBoard = startingBoard

    function addPiece(e) {
        const validMovesList = getValidMoves(currentBoard, whosTurn);
        const squareNum = e.srcElement.id.substring(6);
        if (validMovesList.includes(squareNum)) {
            if (whosTurn === BLACK_DISK) {
                updateBoard(squareNum, BLACK_DISK);
                whosTurn = WHITE_DISK;
            }
            else {
                updateBoard(squareNum, WHITE_DISK);
                whosTurn = BLACK_DISK;
            }
        }
    }

    function getValidMoves(board, player) {
        let validMovesList = [];
        for (let i = 0; i < board.length; i++) {
            for (let j = 0; j < board.length; j++) {
                if (
                    getNumKilledEnemy(board, player, i, j, 1, 1) ||
                    getNumKilledEnemy(board, player, i, j, 1, 0) ||
                    getNumKilledEnemy(board, player, i, j, 1, -1) ||
                    getNumKilledEnemy(board, player, i, j, -1, 1) ||
                    getNumKilledEnemy(board, player, i, j, -1, 0) ||
                    getNumKilledEnemy(board, player, i, j, -1, -1) ||
                    getNumKilledEnemy(board, player, i, j, 0, 1) ||
                    getNumKilledEnemy(board, player, i, j, 0, -1)
                ) {
                    validMovesList.push((i * 8 + j) + "");
                }
            }
        }
        return validMovesList;
    }

    function getNumKilledEnemy(board, player, x, y, deltaX, deltaY) {
        const FRIENDLY = player;
        const ENEMY = -FRIENDLY;

        let nextX = x + deltaX;
        let nextY = y + deltaY;

        if (
            nextX < 0 || 
            nextX >= board.length || 
            nextY < 0 || 
            nextY >= board.length || 
            board[nextX][nextY] != ENEMY
        ) {
            return 0;
        }

        let count = 0;

        while (
            0 <= nextX && nextX < board.length &&
            0 <= nextY && nextY < board.length &&
            board[nextX][nextY] == ENEMY
        ) {
            nextX += deltaX;
            nextY += deltaY;
            count++;
        }

        if (
            nextX < 0 || 
            nextX >= board.length || 
            nextY < 0 || 
            nextY >= board.length || 
            board[nextX][nextY] != FRIENDLY
        ) {
            return 0;
        } 
        else {
            return count;
        }

    }

    function updateBoard(action, player) {
        x = Math.floor(action / currentBoard.length);
        y = action % currentBoard.length;
        for (let delta_x = -1; delta_x < 2; delta_x++) {
            for (let delta_y = -1; delta_y < 2; delta_y++) {
                if (!(delta_x == 0 && delta_y == 0)) {
                    killCount = getNumKilledEnemy(currentBoard, player, x, y, delta_x, delta_y);
                    for (let i = 0; i < killCount; i++) {
                        dx = (i + 1) * delta_x;
                        dy = (i + 1) * delta_y;
                        currentBoard[x + dx][y + dy] = player;
                        updateSquareElement((x + dx) * 8 + y + dy, player);
                    }
                }
            }
        }
        currentBoard[x][y] = player;
        updateSquareElement(x * 8 + y, player);
    }

    function updateSquareElement(squareNum, player) {
        const square = document.querySelector(`#square${squareNum}`);
        const piece = document.createElement("div")
        piece.id = "piece" + squareNum;
        if (player == BLACK_DISK) {
            piece.classList.add("black-piece")
        }
        else {
            piece.classList.add("white-piece")
        }

        square.innerHTML = "";
        square.appendChild(piece);
    }

    squaresList.forEach(square => {
        square.addEventListener('click', addPiece)
    })
</script>
</html>